<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MBA CRM + Elective Planner + Essay Questions</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root{
            --bg:#0b0e16; --panel:#0f1422; --elev:#121a2d; --muted:#9fb0d1; --text:#eaf0ff;
            --border:#22304c; --chip:#151c2c; --accent:#7c9bff;
            --dream: rgba(255,127,150,.12); --target: rgba(255,214,102,.12);
            --safety: rgba(119,255,170,.12); --uswild: rgba(124,155,255,.12);
        }
        body {
            font-family: 'Inter', sans-serif;
            color: var(--text);
            background: radial-gradient(900px 600px at 10% -10%, #0f1a33 0%, rgba(15,26,51,0) 60%),
                        linear-gradient(180deg,#0b0e16,#0b1222 40%, #0a0f1a 100%);
            padding: 1rem;
            min-height: 100vh;
        }
        .tab.active {
            background: linear-gradient(135deg,#24335b,#1a2748);
            border-color: #355296;
        }
        .pill {
            background-color: var(--chip);
        }
        .card h3 {
            margin: 0;
        }
        .table-wrap {
            overflow-x: auto;
        }
        table {
            min-width: 980px;
        }
        th {
            position: sticky;
            top: 0;
            z-index: 10;
        }
        tr:hover td {
            background: rgba(124,155,255,.08);
        }
        .Dream td { background: var(--dream); }
        .Target td { background: var(--target); }
        .Safety td { background: var(--safety); }
        .USWildcard td { background: var(--uswild); }
        
        td[contenteditable=true]:focus {
            box-shadow: 0 0 0 2px #5167ff77 inset;
            background: rgba(81,103,255,.08);
        }

        .planner-grid {
            grid-template-columns: 1fr;
        }
        @media (min-width: 900px) {
            .planner-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100">

<div class="max-w-7xl mx-auto p-4">
    <h1 class="text-3xl font-bold mb-1">MBA CRM + Elective Planner + Essay Questions</h1>
    <div class="text-gray-400 mb-4 text-sm">Generated 2025-08-12 • Full-time MBAs • All data saved locally (localStorage).</div>

    <div id="app-tabs" class="flex flex-wrap gap-2 mb-6">
        <div class="tab bg-slate-800 border border-slate-700 text-gray-200 px-4 py-2 rounded-lg cursor-pointer transition-colors duration-200 hover:bg-slate-700 active" data-tab="crm">School CRM</div>
        <div class="tab bg-slate-800 border border-slate-700 text-gray-200 px-4 py-2 rounded-lg cursor-pointer transition-colors duration-200 hover:bg-slate-700" data-tab="planner">Elective Planner</div>
        <div class="tab bg-slate-800 border border-slate-700 text-gray-200 px-4 py-2 rounded-lg cursor-pointer transition-colors duration-200 hover:bg-slate-700" data-tab="essay">Essay Questions</div>
    </div>

    <!-- CRM -->
    <section id="crm" class="bg-slate-800 border border-slate-700 rounded-xl p-4">
        <div class="flex flex-wrap gap-2 mb-4">
            <input id="q" type="search" placeholder="Search… (school, country, notes)" class="flex-1 min-w-0 p-2 rounded-lg bg-slate-900 border border-slate-700 text-gray-100 placeholder-gray-500">
            <select id="filter-country" class="p-2 rounded-lg bg-slate-900 border border-slate-700 text-gray-100">
                <option value="">All countries</option>
                <option>Spain</option><option>Italy</option><option>Netherlands</option><option>Germany</option>
                <option>United Kingdom</option><option>France</option><option>Sweden</option><option>United States</option>
            </select>
            <select id="filter-category" class="p-2 rounded-lg bg-slate-900 border border-slate-700 text-gray-100">
                <option value="">All categories</option>
                <option>Dream</option><option>Target</option><option>Safety</option><option>US Wildcard</option>
            </select>
            <button id="export" class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium px-4 py-2 rounded-lg transition-colors duration-200">Export CSV</button>
        </div>

        <div class="table-wrap">
            <table id="crm-table" class="w-full text-sm">
                <thead class="bg-slate-900 text-gray-300">
                    <tr>
                        <th class="p-3 text-left border-b border-slate-700">School Name</th>
                        <th class="p-3 text-left border-b border-slate-700">Country</th>
                        <th class="p-3 text-left border-b border-slate-700">Category</th>
                        <th class="p-3 text-left border-b border-slate-700">Duration</th>
                        <th class="p-3 text-left border-b border-slate-700">Average / Median GMAT</th>
                        <th class="p-3 text-left border-b border-slate-700">Application Deadlines (2025–26 cycle)</th>
                        <th class="p-3 text-left border-b border-slate-700">Notes</th>
                        <th class="p-3 text-left border-b border-slate-700">Max Electives (per program)</th>
                        <th class="p-3 text-left border-b border-slate-700">Electives (leave blank)</th>
                        <th class="p-3 text-left border-b border-slate-700">Alumni You Can Contact (leave blank)</th>
                        <th class="p-3 text-left border-b border-slate-700">LinkedIn Contact from AdComms</th>
                    </tr>
                </thead>
                <tbody class="bg-slate-800">
                    <tr class='Dream'><td contenteditable="true" class="p-3 border-b border-slate-700">IESE Business School</td><td class="p-3 border-b border-slate-700"><span class="pill inline-block px-2 py-1 rounded-full text-xs">Spain</span></td><td contenteditable="true" class="p-3 border-b border-slate-700">Dream</td><td contenteditable="true" class="p-3 border-b border-slate-700">15 or 19 months</td><td contenteditable="true" class="p-3 border-b border-slate-700">No official average; GMAT acceptance range 545–715 (Focus) / 580–750 (Classic)</td><td contenteditable="true" class="p-3 border-b border-slate-700">R1: 25 Sep 2025 • R2: 9 Jan 2026 • R3: 12 Mar 2026 • R4*: 8 May 2026</td><td contenteditable="true" class="p-3 border-b border-slate-700">*R4 typically for EU passport holders or visa-exempt; check IESE site</td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td></tr>
                    <tr class='Dream'><td contenteditable="true" class="p-3 border-b border-slate-700">University of Oxford – Saïd</td><td class="p-3 border-b border-slate-700"><span class="pill inline-block px-2 py-1 rounded-full text-xs">United Kingdom</span></td><td contenteditable="true" class="p-3 border-b border-slate-700">Dream</td><td contenteditable="true" class="p-3 border-b border-slate-700">12 months</td><td contenteditable="true" class="p-3 border-b border-slate-700">Median GMAT: 680</td><td contenteditable="true" class="p-3 border-b border-slate-700">Stage 1: 1 Sep 2025 • Stage 2: 1 Oct 2025 • Stage 3: 3 Nov 2025 • Stage 4: 7 Jan 2026 • Stage 5: 16 Mar 2026</td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td></tr>
                    <tr class='Dream'><td contenteditable="true" class="p-3 border-b border-slate-700">University of Cambridge – Judge</td><td class="p-3 border-b border-slate-700"><span class="pill inline-block px-2 py-1 rounded-full text-xs">United Kingdom</span></td><td contenteditable="true" class="p-3 border-b border-slate-700">Dream</td><td contenteditable="true" class="p-3 border-b border-slate-700">12 months</td><td contenteditable="true" class="p-3 border-b border-slate-700">Average GMAT: 697</td><td contenteditable="true" class="p-3 border-b border-slate-700">R2: 6 Oct 2025 • R3: 5 Jan 2026 • R4: 30 Mar 2026 • R5: 5 May 2026</td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td></tr>
                    <tr class='Target'><td contenteditable="true" class="p-3 border-b border-slate-700">IE Business School</td><td class="p-3 border-b border-slate-700"><span class="pill inline-block px-2 py-1 rounded-full text-xs">Spain</span></td><td contenteditable="true" class="p-3 border-b border-slate-700">Target</td><td contenteditable="true" class="p-3 border-b border-slate-700">11–15 months</td><td contenteditable="true" class="p-3 border-b border-slate-700">Average GMAT: ~680</td><td contenteditable="true" class="p-3 border-b border-slate-700">Rolling admissions (examples: final day for Sep 2025 start—1 Sep 2025; Jan 2026 start—30 Dec 2025)</td><td contenteditable="true" class="p-3 border-b border-slate-700">Apply early for scholarships; seats fill on a rolling basis</td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td></tr>
                    <tr class='Target'><td contenteditable="true" class="p-3 border-b border-slate-700">SDA Bocconi</td><td class="p-3 border-b border-slate-700"><span class="pill inline-block px-2 py-1 rounded-full text-xs">Italy</span></td><td contenteditable="true" class="p-3 border-b border-slate-700">Target</td><td contenteditable="true" class="p-3 border-b border-slate-700">12 months</td><td contenteditable="true" class="p-3 border-b border-slate-700">Average GMAT: ~650–665</td><td contenteditable="true" class="p-3 border-b border-slate-700">R1: 4 Nov 2025 • R2: 13 Jan 2026 • R3: 3 Mar 2026 • R4: 15 Apr 2026</td><td contenteditable="true" class="p-3 border-b border-slate-700">Application deadline for 2026 intake: 15 Apr 2026</td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td></tr>
                    <tr class='Target'><td contenteditable="true" class="p-3 border-b border-slate-700">Rotterdam School of Management (RSM)</td><td class="p-3 border-b border-slate-700"><span class="pill inline-block px-2 py-1 rounded-full text-xs">Netherlands</span></td><td contenteditable="true" class="p-3 border-b border-slate-700">Target</td><td contenteditable="true" class="p-3 border-b border-slate-700">12 months</td><td contenteditable="true" class="p-3 border-b border-slate-700">Average GMAT: ~640</td><td contenteditable="true" class="p-3 border-b border-slate-700">Jan 2026 intake rounds: 11 Feb • 8 Apr • 3 Jun • 12 Aug • 1 Oct • 4 Nov 2025</td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td></tr>
                    <tr class='Target'><td contenteditable="true" class="p-3 border-b border-slate-700">Imperial College Business School</td><td class="p-3 border-b border-slate-700"><span class="pill inline-block px-2 py-1 rounded-full text-xs">United Kingdom</span></td><td contenteditable="true" class="p-3 border-b border-slate-700">Target</td><td contenteditable="true" class="p-3 border-b border-slate-700">12 months</td><td contenteditable="true" class="p-3 border-b border-slate-700">Average GMAT: ~660 (school does not publish)</td><td contenteditable="true" class="p-3 border-b border-slate-700">23 Sep 2025 • 13 Jan 2026 • 17 Mar 2026 • 28 Apr 2026</td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td></tr>
                    <tr class='Target'><td contenteditable="true" class="p-3 border-b border-slate-700">ESSEC Business School (Global MBA)</td><td class="p-3 border-b border-slate-700"><span class="pill inline-block px-2 py-1 rounded-full text-xs">France</span></td><td contenteditable="true" class="p-3 border-b border-slate-700">Target</td><td contenteditable="true" class="p-3 border-b border-slate-700">12 months</td><td contenteditable="true" class="p-3 border-b border-slate-700">Average GMAT Focus (equiv): ~615</td><td contenteditable="true" class="p-3 border-b border-slate-700">Apps accepted through Jun 2026; Early Bird: 6 Oct 2025</td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td></tr>
                    <tr class='Safety'><td contenteditable="true" class="p-3 border-b border-slate-700">Warwick Business School</td><td class="p-3 border-b border-slate-700"><span class="pill inline-block px-2 py-1 rounded-full text-xs">United Kingdom</span></td><td contenteditable="true" class="p-3 border-b border-slate-700">Safety</td><td contenteditable="true" class="p-3 border-b border-slate-700">12 months</td><td contenteditable="true" class="p-3 border-b border-slate-700">Average GMAT: 670 (615 Focus)</td><td contenteditable="true" class="p-3 border-b border-slate-700">2026 cycle TBA; 2025 example rounds: 6 Oct • 10 Nov • 12 Jan • 30 Mar • 21 May (Intl) • 31 Jul</td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td></tr>
                    <tr class='Safety'><td contenteditable="true" class="p-3 border-b border-slate-700">ESADE Barcelona</td><td class="p-3 border-b border-slate-700"><span class="pill inline-block px-2 py-1 rounded-full text-xs">Spain</span></td><td contenteditable="true" class="p-3 border-b border-slate-700">Safety</td><td contenteditable="true" class="p-3 border-b border-slate-700">12 / 15 / 18 months</td><td contenteditable="true" class="p-3 border-b border-slate-700">Average GMAT: ~660 (615 Focus)</td><td contenteditable="true" class="p-3 border-b border-slate-700">2026 cycle TBA; 2024–25 rounds ran Oct–Jun monthly (9 rounds)</td><td contenteditable="true" class="p-3 border-b border-slate-700">Expect similar cadence; verify when 2026 calendar posts</td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td></tr>
                    <tr class='Safety'><td contenteditable="true" class="p-3 border-b border-slate-700">ESMT Berlin</td><td class="p-3 border-b border-slate-700"><span class="pill inline-block px-2 py-1 rounded-full text-xs">Germany</span></td><td contenteditable="true" class="p-3 border-b border-slate-700">Safety</td><td contenteditable="true" class="p-3 border-b border-slate-700">15 months</td><td contenteditable="true" class="p-3 border-b border-slate-700">Average GMAT: ~640</td><td contenteditable="true" class="p-3 border-b border-slate-700">Jan 2026 intake timeline: R1 28 Feb 2025 • R2 11 Apr 2025 • R3 30 May 2025 • Visa cutoff 22 Aug 2025 • Final 14 Nov 2025</td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td></tr>
                    <tr class='Safety'><td contenteditable="true" class="p-3 border-b border-slate-700">Stockholm School of Economics (SSE) – MBA</td><td class="p-3 border-b border-slate-700"><span class="pill inline-block px-2 py-1 rounded-full text-xs">Sweden</span></td><td contenteditable="true" class="p-3 border-b border-slate-700">Safety</td><td contenteditable="true" class="p-3 border-b border-slate-700">~12 months (intensive / exec-style)</td><td contenteditable="true" class="p-3 border-b border-slate-700">GMAT: not required; not published</td><td contenteditable="true" class="p-3 border-b border-slate-700">Rolling; decisions end-May/Jun/Aug/Sep/Oct (next start Jan)</td><td contenteditable="true" class="p-3 border-b border-slate-700">Program branded as Executive MBA; confirm fit vs full-time MBA</td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td></tr>
                    <tr class='USWildcard'><td contenteditable="true" class="p-3 border-b border-slate-700">Michigan Ross School of Business</td><td class="p-3 border-b border-slate-700"><span class="pill inline-block px-2 py-1 rounded-full text-xs">United States</span></td><td contenteditable="true" class="p-3 border-b border-slate-700">US Wildcard</td><td contenteditable="true" class="p-3 border-b border-slate-700">24 months</td><td contenteditable="true" class="p-3 border-b border-slate-700">Average GMAT: 728</td><td contenteditable="true" class="p-3 border-b border-slate-700">R1: 8 Sep 2025 • R2: 5 Jan 2026 • R3: 23 Mar 2026</td><td contenteditable="true" class="p-3 border-b border-slate-700">Apps due 11:59pm ET on deadlines</td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td><td contenteditable="true" class="p-3 border-b border-slate-700"></td></tr>
                </tbody>
            </table>
        </div>
        <p class="text-sm text-gray-400 mt-4">Tip: Click any cell to edit. Your changes auto-save locally. Export CSV anytime.</p>
    </section>

    <!-- PLANNER -->
    <section id="planner" class="bg-slate-800 border border-slate-700 rounded-xl p-4 mt-4" style="display:none">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="bg-slate-900 border border-slate-700 rounded-lg p-4">
                <h3 class="font-semibold text-lg mb-2">Electives — Considering</h3>
                <div class="flex flex-wrap gap-2 mb-4">
                    <select id="pl-school" class="w-full md:w-auto p-2 rounded-lg bg-slate-800 border border-slate-700 text-gray-100"></select>
                    <input id="pl-category" type="text" placeholder="Broad category (e.g., Strategy & Geopolitics)" class="flex-1 p-2 rounded-lg bg-slate-800 border border-slate-700 text-gray-100 placeholder-gray-500">
                    <input id="pl-title" type="text" placeholder="Elective title (exact, from brochure)" class="flex-1 p-2 rounded-lg bg-slate-800 border border-slate-700 text-gray-100 placeholder-gray-500">
                    <input id="pl-notes" type="text" placeholder="Notes (why relevant, prof, term)" class="flex-1 p-2 rounded-lg bg-slate-800 border border-slate-700 text-gray-100 placeholder-gray-500">
                    <button class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium px-4 py-2 rounded-lg transition-colors duration-200" id="pl-add">Add</button>
                </div>
                <div id="considering"></div>
            </div>
            <div class="bg-slate-900 border border-slate-700 rounded-lg p-4">
                <h3 class="font-semibold text-lg mb-2">Electives — Chosen</h3>
                <p class="text-xs text-gray-400 mb-2">Counters respect each school’s <b>Max Electives</b> (soft limit) set in the CRM.</p>
                <div id="chosen"></div>
            </div>
        </div>
        <div class="flex flex-wrap gap-2 mt-4">
            <button class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium px-4 py-2 rounded-lg transition-colors duration-200" id="export-planner">Export Planner JSON</button>
            <label class="bg-slate-700 hover:bg-slate-600 text-white font-medium px-4 py-2 rounded-lg transition-colors duration-200 cursor-pointer">
                Import JSON
                <input id="import-json" type="file" accept="application/json" class="hidden">
            </label>
            <button class="bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-lg transition-colors duration-200" id="clear-planner">Clear Planner</button>
        </div>
    </section>

    <!-- ESSAY -->
    <section id="essay" class="bg-slate-800 border border-slate-700 rounded-xl p-4 mt-4" style="display:none">
        <div class="flex flex-wrap gap-2 mb-2">
            <select id="eq-school" class="p-2 rounded-lg bg-slate-900 border border-slate-700 text-gray-100 flex-1"></select>
            <select id="eq-type" class="p-2 rounded-lg bg-slate-900 border border-slate-700 text-gray-100 flex-1">
                <option value="Required essay">Required essay</option>
                <option value="Optional essay">Optional essay</option>
                <option value="Short answer">Short answer</option>
                <option value="Video/Kira prompt">Video/Kira prompt</option>
                <option value="Scholarship essay">Scholarship essay</option>
            </select>
            <input id="eq-wordlimit" type="number" min="0" placeholder="Word limit (e.g., 500)" class="p-2 rounded-lg bg-slate-900 border border-slate-700 text-gray-100 placeholder-gray-500 flex-1">
            <input id="eq-deadline" type="date" placeholder="Deadline" class="p-2 rounded-lg bg-slate-900 border border-slate-700 text-gray-100 placeholder-gray-500 flex-1">
        </div>
        <div class="flex flex-wrap gap-2 mb-2">
            <input id="eq-theme" type="text" placeholder="Theme (e.g., goals, why school, leadership)" class="flex-1 p-2 rounded-lg bg-slate-900 border border-slate-700 text-gray-100 placeholder-gray-500">
            <input id="eq-notes" type="text" placeholder="Notes (how it fits your story)" class="flex-1 p-2 rounded-lg bg-slate-900 border border-slate-700 text-gray-100 placeholder-gray-500">
        </div>
        <div class="flex flex-wrap gap-2 mb-2">
            <textarea id="eq-question" placeholder="Paste the exact essay question here" class="w-full p-2 rounded-lg bg-slate-900 border border-slate-700 text-gray-100 placeholder-gray-500 min-h-[110px] resize-y"></textarea>
        </div>
        <div class="flex flex-wrap gap-2 mb-4">
            <button class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium px-4 py-2 rounded-lg transition-colors duration-200" id="eq-add">Add Question</button>
            <button class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium px-4 py-2 rounded-lg transition-colors duration-200" id="eq-export">Export JSON</button>
            <label class="bg-slate-700 hover:bg-slate-600 text-white font-medium px-4 py-2 rounded-lg transition-colors duration-200 cursor-pointer">
                Import JSON
                <input id="eq-import" type="file" accept="application/json" class="hidden">
            </label>
            <button class="bg-red-600 hover:bg-red-700 text-white font-medium px-4 py-2 rounded-lg transition-colors duration-200" id="eq-clear">Clear All</button>
        </div>
        <div id="eq-list" class="grid gap-4 md:grid-cols-2 lg:grid-cols-3"></div>
        <p class="text-sm text-gray-400 mt-4">All entries save locally (localStorage). Use Export/Import for backup.</p>
    </section>
</div>

<script>
    /* ===== Tabs ===== */
    (function(){
        const panels = { crm: document.getElementById('crm'), planner: document.getElementById('planner'), essay: document.getElementById('essay') };
        const tabs = document.getElementById('app-tabs');
        function show(id){
            Object.keys(panels).forEach(k => panels[k].style.display = (k===id?'block':'none'));
            tabs.querySelectorAll('.tab').forEach(t=>t.classList.toggle('active', t.dataset.tab===id));
            if(id==='planner'){ setTimeout(refreshPlannerSchoolOptions, 50); }
            if(id==='essay'){ setTimeout(populateEssaySchoolSelect, 50); renderEQ(); }
        }
        tabs.addEventListener('click', (e)=>{
            const t = e.target.closest('.tab'); if(!t) return;
            show(t.dataset.tab);
        });
        show('crm');
    })();

    /* ===== CRM: editing, filters, CSV, autosave ===== */
    (function(){
        const KEY='mba_crm_sheet_v5';
        const tbody = document.querySelector('#crm-table tbody');

        function enableEditing(){
            tbody.querySelectorAll('td[contenteditable="true"]').forEach(td=>{
                td.addEventListener('blur', autosave);
            });
        }

        function autosave(){
            const rows=[...tbody.querySelectorAll('tr')].map(tr =>
                [...tr.children].map((td,j)=>{
                    return j===1 ? (td.innerText||'').trim() : td.innerText;
                })
            );
            localStorage.setItem(KEY, JSON.stringify(rows));
            refreshPlannerSchoolOptions();
            populateEssaySchoolSelect();
        }

        function load(){
            const raw=localStorage.getItem(KEY); if(!raw) return;
            const data=JSON.parse(raw);
            const trs=tbody.querySelectorAll('tr');
            data.forEach((cells,i)=>{
                const tr=trs[i]; if(!tr) return;
                cells.forEach((v,j)=>{
                    if(j===1){ tr.children[j].innerHTML = `<span class="pill inline-block px-2 py-1 rounded-full text-xs">${v}</span>`; }
                    else tr.children[j].innerText = v;
                });
            });
        }

        function filter(){
            const q=document.getElementById('q').value.toLowerCase().trim();
            const country=document.getElementById('filter-country').value;
            const cat=document.getElementById('filter-category').value.toLowerCase();
            tbody.querySelectorAll('tr').forEach(tr=>{
                const text=tr.innerText.toLowerCase();
                let ok = !q || text.includes(q);
                if(country) ok = ok && tr.children[1].innerText.trim()===country;
                if(cat) ok = ok && tr.children[2].innerText.toLowerCase().trim()===cat;
                tr.style.display = ok ? '' : 'none';
            });
        }

        function exportCSV(){
            const rows = [];
            const table = document.querySelector('#crm-table');
            table.querySelectorAll('tr').forEach(tr=>{
                const cols = [];
                tr.querySelectorAll('th,td').forEach(td=>{
                    let t = td.innerText.replace(/\n/g,' ').replace(/\s+/g,' ').trim();
                    if(t.includes(',')||t.includes('"')) t='"'+t.replace(/"/g,'""')+'"';
                    cols.push(t);
                });
                rows.push(cols.join(','));
            });
            const blob = new Blob([rows.join('\n')], {type:'text/csv;charset=utf-8;'});
            const url = URL.createObjectURL(blob);
            const a=document.createElement('a'); a.href=url; a.download='MBA_CRM.csv'; a.click(); URL.revokeObjectURL(url);
        }

        window.addEventListener('load', ()=>{
            load(); enableEditing();
            document.getElementById('q').addEventListener('input', filter);
            document.getElementById('filter-country').addEventListener('input', filter);
            document.getElementById('filter-category').addEventListener('input', filter);
            document.getElementById('export').addEventListener('click', exportCSV);
        });
        
        const table = document.getElementById('crm-table');
        if (table && 'MutationObserver' in window) {
            const mo = new MutationObserver(()=>{ clearTimeout(mo._t); mo._t=setTimeout(()=>{ refreshPlannerSchoolOptions(); populateEssaySchoolSelect(); }, 50); });
            mo.observe(table, { childList:true, subtree:true, characterData:true });
        }
    })();

    /* ===== Helpers to read school names + max electives from CRM ===== */
    function getCRMRows(){
        const rows=[...document.querySelectorAll('#crm-table tbody tr')];
        return rows.map(tr=>[...tr.children].map(td=>td.innerText));
    }
    function getSchoolNames(){
        return getCRMRows().map(r=>r[0].trim()).filter(Boolean);
    }
    function getMaxForSchool(name){
        const rows=getCRMRows();
        for(const r of rows){
            if(r[0].trim()===name.trim()){
                const raw=r[7]?.trim(); const n=parseInt(raw,10);
                return isNaN(n)?null:n;
            }
        }
        return null;
    }

    /* ===== Elective Planner ===== */
    (function(){
        const PK_CONSIDERING='electives_considering_v3';
        const PK_CHOSEN='electives_chosen_v3';

        function countsForSchool(name, chosen){
            return chosen.filter(x=>x.school===name).length;
        }
        function softLimitLabel(name, chosen){
            const max=getMaxForSchool(name);
            const cnt=countsForSchool(name, chosen);
            if(max==null) return `<span class="text-sm text-gray-400">Max: —</span>`;
            if(cnt<max) return `<span class="text-sm text-green-500">Chosen ${cnt} / ${max}</span>`;
            if(cnt===max) return `<span class="text-sm text-yellow-500">Chosen ${cnt} / ${max} (full)</span>`;
            return `<span class="text-sm text-red-500">Over by ${cnt-max}</span>`;
        }

        function renderLists(){
            const ctnC=document.getElementById('considering');
            const ctnH=document.getElementById('chosen');
            const considering=JSON.parse(localStorage.getItem(PK_CONSIDERING)||'[]');
            const chosen=JSON.parse(localStorage.getItem(PK_CHOSEN)||'[]');

            function card(it, list){
                return `
                    <div class="flex items-center justify-between p-3 rounded-lg bg-slate-800 border border-slate-700 mb-2" data-school="${it.school}">
                        <div class="flex-1 mr-4">
                            <div class="font-semibold">${it.school}</div>
                            <div class="text-xs text-gray-400">${it.category} • ${it.title}</div>
                            ${it.notes ? `<div class="text-xs text-gray-500">${it.notes}</div>` : ''}
                            ${softLimitLabel(it.school, chosen)}
                        </div>
                        <div class="flex gap-2">
                            ${list==='considering' ? '<button class="bg-green-600 hover:bg-green-700 text-white text-xs px-2 py-1 rounded-md" data-move="to-chosen">Choose</button>' : '<button class="bg-yellow-600 hover:bg-yellow-700 text-white text-xs px-2 py-1 rounded-md" data-move="to-considering">Unchoose</button>'}
                            <button class="bg-red-600 hover:bg-red-700 text-white text-xs px-2 py-1 rounded-md" data-del="1">Delete</button>
                        </div>
                    </div>`;
            }

            ctnC.innerHTML = considering.length ? considering.map(it=>card(it,'considering')).join('') : '<p class="text-sm text-gray-400">No electives yet — add them above.</p>';
            ctnH.innerHTML = chosen.length ? chosen.map(it=>card(it,'chosen')).join('') : '<p class="text-sm text-gray-400">Nothing chosen yet.</p>';

            function bind(container, listName){
                container.querySelectorAll('button').forEach(btn=>{
                    btn.addEventListener('click', (e)=>{
                        const itemNode = e.target.closest('.flex');
                        const index = [...itemNode.parentNode.children].indexOf(itemNode);
                        const key = (listName==='considering')?PK_CONSIDERING:PK_CHOSEN;
                        const arr = JSON.parse(localStorage.getItem(key)||'[]');
                        
                        if(e.target.dataset.del){
                            arr.splice(index, 1);
                        } else if(e.target.dataset.move){
                            const srcKey = (listName==='considering')?PK_CONSIDERING:PK_CHOSEN;
                            const dstKey = (listName==='considering')?PK_CHOSEN:PK_CONSIDERING;
                            const src = JSON.parse(localStorage.getItem(srcKey)||'[]');
                            const dst = JSON.parse(localStorage.getItem(dstKey)||'[]');
                            const item = src.splice(index,1)[0];
                            dst.push(item);
                            localStorage.setItem(srcKey, JSON.stringify(src));
                            localStorage.setItem(dstKey, JSON.stringify(dst));
                        }
                        
                        localStorage.setItem(key, JSON.stringify(arr));
                        renderLists();
                    });
                });
            }
            bind(ctnC, 'considering');
            bind(ctnH, 'chosen');
        }

        function refreshPlannerSchoolOptions(){
            const sel=document.getElementById('pl-school'); if(!sel) return;
            const names=getSchoolNames();
            sel.innerHTML = names.length ? names.map(n=>`<option>${n}</option>`).join('') : `<option value="">— No schools detected —</option>`;
        }
        window.refreshPlannerSchoolOptions = refreshPlannerSchoolOptions;

        document.getElementById('pl-add').addEventListener('click', ()=>{
            const school=document.getElementById('pl-school').value.trim();
            const category=document.getElementById('pl-category').value.trim();
            const title=document.getElementById('pl-title').value.trim();
            const notes=document.getElementById('pl-notes').value.trim();
            if(!school||!category||!title){ alert('Please fill School, Category, and Elective title.'); return; }
            const arr=JSON.parse(localStorage.getItem(PK_CONSIDERING)||'[]');
            arr.push({school, category, title, notes});
            localStorage.setItem(PK_CONSIDERING, JSON.stringify(arr));
            document.getElementById('pl-title').value=''; document.getElementById('pl-notes').value='';
            renderLists();
        });

        document.getElementById('export-planner').addEventListener('click', ()=>{
            const data = {
                considering: JSON.parse(localStorage.getItem(PK_CONSIDERING)||'[]'),
                chosen: JSON.parse(localStorage.getItem(PK_CHOSEN)||'[]')
            };
            const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
            const url = URL.createObjectURL(blob);
            const a=document.createElement('a'); a.href=url; a.download='ElectivePlanner.json'; a.click(); URL.revokeObjectURL(url);
        });
        document.getElementById('import-json').addEventListener('change', (e)=>{
            const file=e.target.files[0]; if(!file) return;
            const reader=new FileReader();
            reader.onload=()=>{
                try{
                    const data=JSON.parse(reader.result);
                    if(data.considering) localStorage.setItem(PK_CONSIDERING, JSON.stringify(data.considering));
                    if(data.chosen) localStorage.setItem(PK_CHOSEN, JSON.stringify(data.chosen));
                    renderLists();
                    alert('Planner data imported.');
                }catch(err){ alert('Invalid JSON'); }
            };
            reader.readAsText(file);
        });
        document.getElementById('clear-planner').addEventListener('click', ()=>{
            if(confirm('Clear all electives in planner?')){
                localStorage.removeItem(PK_CONSIDERING);
                localStorage.removeItem(PK_CHOSEN);
                renderLists();
            }
        });

        window.addEventListener('load', ()=>{ refreshPlannerSchoolOptions(); renderLists(); });
    })();

    /* ===== Essay Questions ===== */
    (function(){
        const KEY_EQ = 'essay_questions_v2';
        let editingId = null;

        function populateEssaySchoolSelect(){
            const sel = document.getElementById('eq-school'); if(!sel) return;
            const names=getSchoolNames();
            sel.innerHTML = names.length ? names.map(n=>`<option>${n}</option>`).join('') : `<option value="">— No schools detected —</option>`;
        }
        window.populateEssaySchoolSelect = populateEssaySchoolSelect;

        function loadEQ(){ try{ return JSON.parse(localStorage.getItem(KEY_EQ)||'[]'); }catch(e){ return []; } }
        function saveEQ(arr){ localStorage.setItem(KEY_EQ, JSON.stringify(arr)); }

        function renderEQ(){
            const list = document.getElementById('eq-list');
            const data = loadEQ();
            if(!data.length){ list.innerHTML = '<div class="bg-slate-900 border border-slate-700 rounded-lg p-4 text-sm text-gray-400">No questions yet. Add one above.</div>'; return; }
            const bySchool = {};
            data.forEach(it => (bySchool[it.school] = bySchool[it.school] || []).push(it));
            
            const blocks = Object.keys(bySchool).sort().map(school=>{
                const questionsHtml = bySchool[school].map(it=>{
                    const tags = [
                        it.type ? `<span class="bg-slate-700 text-gray-200 text-xs font-semibold px-2 py-1 rounded-full">${it.type}</span>`:'',
                        it.wordlimit ? `<span class="bg-slate-700 text-gray-200 text-xs font-semibold px-2 py-1 rounded-full">${it.wordlimit} words</span>`:'',
                        it.deadline ? `<span class="bg-slate-700 text-gray-200 text-xs font-semibold px-2 py-1 rounded-full">Due: ${it.deadline}</span>`:'',
                        it.theme ? `<span class="bg-slate-700 text-gray-200 text-xs font-semibold px-2 py-1 rounded-full">Theme: ${it.theme}</span>`:''
                    ].filter(Boolean).join(' ');

                    return `
                        <div class="bg-slate-900 border border-slate-700 rounded-lg p-4 transition-all duration-200" data-id="${it.id}">
                            <div class="mb-2 flex flex-wrap gap-2">${tags}</div>
                            <h4 class="font-bold text-lg mb-2">${it.question}</h4>
                            ${it.notes ? `<div class="text-sm text-gray-400 mb-2">Notes: ${it.notes}</div>` : ''}
                            <div class="flex gap-2">
                                <button class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium text-xs px-3 py-1 rounded-md" data-edit="1">Edit</button>
                                <button class="bg-red-600 hover:bg-red-700 text-white font-medium text-xs px-3 py-1 rounded-md" data-del="1">Delete</button>
                            </div>
                        </div>`;
                }).join('');

                return `
                    <div>
                        <h3 class="font-bold text-2xl mt-6 mb-2 text-indigo-400">${school}</h3>
                        <div class="grid gap-4">
                            ${questionsHtml}
                        </div>
                    </div>`;
            }).join('');
            
            list.innerHTML = blocks;

            list.querySelectorAll('[data-del]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.target.closest('[data-id]').getAttribute('data-id');
                    const arr = loadEQ().filter(x => String(x.id) !== String(id));
                    saveEQ(arr);
                    renderEQ();
                });
            });

            list.querySelectorAll('[data-edit]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.target.closest('[data-id]').getAttribute('data-id');
                    const it = loadEQ().find(x => String(x.id) === String(id));
                    if (!it) return;
                    document.getElementById('eq-school').value = it.school;
                    document.getElementById('eq-type').value = it.type || 'Required essay';
                    document.getElementById('eq-wordlimit').value = it.wordlimit || '';
                    document.getElementById('eq-deadline').value = it.deadline || '';
                    document.getElementById('eq-theme').value = it.theme || '';
                    document.getElementById('eq-notes').value = it.notes || '';
                    document.getElementById('eq-question').value = it.question || '';
                    editingId = it.id;
                    document.getElementById('eq-add').textContent = 'Update Question';
                    document.querySelector('.tab[data-tab="essay"]').click();
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            });
        }

        function addOrUpdate(){
            const school = document.getElementById('eq-school').value.trim();
            const type = document.getElementById('eq-type').value.trim();
            const wordlimit = document.getElementById('eq-wordlimit').value.trim();
            const deadline = document.getElementById('eq-deadline').value.trim();
            const theme = document.getElementById('eq-theme').value.trim();
            const notes = document.getElementById('eq-notes').value.trim();
            const question = document.getElementById('eq-question').value.trim();
            if(!school || !question){ alert('Please select a school and paste the question.'); return; }

            const arr = loadEQ();

            if(editingId){
                const ix = arr.findIndex(x => String(x.id)===String(editingId));
                if(ix>=0){
                    arr[ix] = { id: editingId, school, type, wordlimit, deadline, theme, notes, question };
                }
                editingId = null;
                document.getElementById('eq-add').textContent = 'Add Question';
            } else {
                arr.push({ id: Date.now(), school, type, wordlimit, deadline, theme, notes, question });
            }
            saveEQ(arr);

            document.getElementById('eq-type').value = 'Required essay';
            document.getElementById('eq-wordlimit').value = '';
            document.getElementById('eq-deadline').value = '';
            document.getElementById('eq-theme').value = '';
            document.getElementById('eq-notes').value = '';
            document.getElementById('eq-question').value = '';

            renderEQ();
        }

        document.getElementById('eq-add').addEventListener('click', addOrUpdate);

        function exportEQ(){
            const arr = loadEQ();
            const blob = new Blob([JSON.stringify(arr, null, 2)], {type:'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); a.href=url; a.download='EssayQuestions.json'; a.click(); URL.revokeObjectURL(url);
        }
        document.getElementById('eq-export').addEventListener('click', exportEQ);

        function importEQ(file){
            const reader = new FileReader();
            reader.onload=()=>{
                try{
                    const data=JSON.parse(reader.result);
                    if(Array.isArray(data)){ localStorage.setItem(KEY_EQ, JSON.stringify(data)); renderEQ(); }
                    else alert('Invalid JSON');
                }catch(e){ alert('Invalid JSON'); }
            };
            reader.readAsText(file);
        }
        document.getElementById('eq-import').addEventListener('change', (e)=>{
            const file=e.target.files[0]; if(!file) return;
            importEQ(file);
        });

        document.getElementById('eq-clear').addEventListener('click', ()=>{
            if(confirm('Clear all saved essay questions? This cannot be undone.')){
                localStorage.removeItem(KEY_EQ);
                renderEQ();
            }
        });

        window.addEventListener('load', ()=>{ populateEssaySchoolSelect(); renderEQ(); });
    })();
</script>
</body>
</html>
